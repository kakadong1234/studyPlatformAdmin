<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>铜锣湾企业学习平台</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../font-awesome/css/font-awesome.css" rel="stylesheet">
    <link href="../css/animate.css" rel="stylesheet">
    <link href="../css/style.css" rel="stylesheet">
    <link rel="stylesheet" href="../js/multiple/multiple-select.css" />
    <script src="../js/angularjs/angular.min.js"></script>
    <script language="JavaScript" src="https://g.alicdn.com/dingding/open-develop/1.9.0/dingtalk.js"></script>
</head>

<body ng-app="myApp" ng-controller="myCtrl"  data-ng-init="load()">

<div id="wrapper">

    <nav class="navbar-default navbar-static-side" role="navigation">
        <div class="sidebar-collapse">
            <ul class="nav metismenu" id="side-menu">
                <li class="nav-header">
                    <div class="dropdown profile-element">
                        <h3 style="color: white;font-size: 18px">
                             <!-- <img src="img/login.png" style="width: 50px;height: auto"> -->
                            铜锣湾企业学习平台
                        </h3>
                    </div>
                    <div class="logo-element">
                        党建云
                    </div>
                </li>
                <li class="active">
                    <a href="article_home.html" target="_self"><i class="fa fa-th-large"></i> <span class="nav-label">课程中心</span><span class="fa arrow"></span></a>
                    <ul class="nav nav-second-level collapse">
                        <li class="active"><a href="article_home.html" target="_self">文章管理</a></li>
                        <li><a href="article_type.html" target="_self">文章类型</a></li>
                        <!--<li><a href="article_comment.html" target="_self">评论管理</a></li>-->
                    </ul>
                </li>
                <li >
                    <a href="village_home.html" target="_self"><i class="fa fa-th-large"></i> <span class="nav-label">党建大数据</span><span class="fa arrow"></span></a>
                    <ul class="nav nav-second-level collapse">
                        <li><a href="village_home.html" target="_self">党支部管理</a></li>
                        <li><a href="ganbu_manage.html" target="_self">驻村干部管理</a></li>
                        <li><a href="flags_piao.html" target="_self">党建地图</a></li>
                    </ul>
                </li>

                <!-- <li>
                    <a href="flags_piao.html" target="_self"><i class="fa fa-diamond"></i> <span class="nav-label">党建地图</span></a>
                </li> -->

                <!--<li>-->
                <!--<a href="news_manage.html" target="_self"><i class="fa fa-diamond"></i> <span class="nav-label">党建新闻管理</span></a>-->
                <!--</li>-->
                <!--<li>-->
                <!--<a href="three_sessions.html" target="_self"><i class="fa fa-diamond"></i> <span class="nav-label">三会一课</span></a>-->
                <!--</li>-->
                <li>
                    <a href="table_data_tables.html#" target="_self"><i class="fa fa-bar-chart-o"></i> <span class="nav-label">考试中心</span><span class="fa arrow"></span></a>
                    <ul class="nav nav-second-level collapse">
                        <!-- <li><a href="graph_flot.html" target="_self">教学资源</a></li> -->
                        <li><a href="examination_paper_list.html" target="_self">考试管理</a></li>
                        <li><a href="test_manage.html" target="_self">考试题管理</a></li>
                        <li><a href="study_credit_list.html" target="_self">在线学习学分配置</a></li>
                        <!-- <li><a href="graph_chartjs.html" target="_self">活动开展情况</a></li> -->
                    </ul>
                </li>
                <!--<li>-->
                <!--<a href="#" target="_self"><i class="fa fa-wrench"></i> <span class="nav-label">系统管理</span><span class="fa arrow"></span></a>-->
                <!--<ul class="nav nav-second-level collapse" >-->
                <!--<li><a href="#" target="_self">系统配置</a></li>-->
                <!--<li><a href="#" target="_self">权限管理</a></li>-->
                <!--<li><a href="login.html" target="_self">退出</a></li>-->
                <!--</ul>-->
                <!--</li>-->

            </ul>

        </div>
    </nav>

    <div id="page-wrapper" class="gray-bg">
        <div class="row border-bottom">
            <nav class="navbar navbar-static-top" role="navigation" style="margin-bottom: 0">
                <div class="navbar-header">
                    <a class="navbar-minimalize minimalize-styl-2 btn btn-primary " href="article_modify.html"><i class="fa fa-bars"></i> </a>
                    <form role="search" class="navbar-form-custom" action="#">
                        <div class="form-group">
                            <input type="text"  class="form-control" name="top-search" id="top-search">
                        </div>
                    </form>
                </div>

            </nav>
        </div>
        <div class="wrapper wrapper-content animated fadeInRight">
            <div class="row">
                <div class="col-lg-12">
                    <div class="ibox float-e-margins">
                        <div class="ibox-title">
                            <h5>文章编写：<small>请在此编写您的文章...</small></h5>
                            <div class="ibox-tools">
                                <a class="collapse-link">
                                    <i class="fa fa-chevron-up"></i>
                                </a>
                                <a class="close-link">
                                    <i class="fa fa-times"></i>
                                </a>
                            </div>
                        </div>
                        <div class="ibox-content">
                            <div class="row">
                                <div class="col-md-6 b-r">
                                    <div class="form-group">
                                        <div class="col-md-12" style="padding: 10px 0px">
                                            <div class="col-md-2 text-center" style="margin-top: 8px">
                                                <strong>文章类型选择：</strong>
                                            </div>
                                            <div class="col-md-6">
                                                <select id="ms" multiple="multiple" >
                                                    <option value="21">习近平新时代中国特色社会主义思想</option>
                                                    <option value="22">党建</option>
                                                    <option value="23">农技</option>
                                                    <option value="24">医疗</option>
                                                    <option value="25">健康</option>
                                                    <option value="26">法律</option>
                                                    <option value="27">教育</option>
                                                    <option value="31">政策法规</option>
                                                    <option value="32">工作动态</option>
                                                    <option value="33">从严治党</option>
                                                    <option value="34">时事要闻</option>
                                                    <option value="35">媒体关注</option>
                                                    <option value="36">史海沉钩</option>
                                                    <option value="37">先进典型</option>
                                                    <option value="38">其它</option>
                                                    <option value="41">党建新闻</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-12" style="padding: 10px 0px">
                                            <div class="col-md-2 text-center" style="margin-top: 8px">
                                                <strong>文章来源：</strong>
                                            </div>
                                            <div class="col-md-6">
                                                <input type="text" class="form-control" placeholder="文章来源" name="source" ng-model="source">
                                            </div>
                                        </div>

                                        <div class="col-md-12" style="padding: 10px 0px">
                                            <div class="col-md-2 text-center" style="margin-top: 8px">
                                                <strong>党组织：</strong>
                                            </div>
                                            <div class="col-md-6">
                                                <select class="form-control">
                                                    <option>六盘水党组织</option>
                                                </select>
                                            </div>
                                        </div>


                                        <div class="col-md-12" style="padding: 10px 0px">
                                            <div class="col-md-4" style="text-align: right;margin-top: 7px">
                                                <strong>是否设置为他山之石：</strong><input type="checkbox" style="width: 20px;height: 20px" name="stoneIs" ng-model="stoneIs" ng-change="stoneClick(stoneIs)">
                                            </div>

                                            <div class="col-md-4" style="text-align: right;margin-top: 7px">
                                                <strong>是否设置为banner：</strong><input type="checkbox" style="width: 20px;height: 20px" name="bannerIs" ng-model="bannerIs" ng-change="bannerClick(bannerIs)">
                                            </div>

                                        </div>
                                        <div class="col-md-12" style="padding: 10px 0px">
                                            <div class="col-md-4" style="text-align: right;margin-top: 7px">
                                                <strong>是否可以评论：</strong><input type="checkbox" style="width: 20px;height: 20px" name="commentIs" ng-model="commentIs" ng-change="commentClick(pingjia)">
                                            </div>
                                            <div class="col-md-4" style="text-align: right;">
                                                <strong style="margin-top: 8px;">是否是视频教程：</strong><input type="checkbox" style="width: 20px;height: 20px" name="video" ng-model="video" ng-change="shifoushiping()">
                                            </div>
                                        </div>
                                        <div class="col-md-12 b-r" ng-show="isShow">
                                            <div class="form-group" style="position: relative">
                                                <div class="col-md-2" style="text-align: right;margin-top: 7px">
                                                    <label style="display: block">视频地址：</label>
                                                </div>
                                                <div class="col-md-6">
                                                    <input type="url" class="form-control" placeholder="在此输入视频地址" name="urls" ng-model="urls">
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="col-md-12" style="padding: 10px 0px">
                                        <div class="col-md-2 text-center" style="margin-top: 8px">
                                            <strong>文章标题：</strong>
                                        </div>
                                        <div class="col-md-6">
                                            <input type="text" class="form-control" placeholder="请输入文章标题" name="title" ng-model="title">
                                        </div>
                                    </div>

                                    <div class="col-md-12" style="padding: 10px 0px">
                                        <div class="col-md-2 text-center" style="margin-top: 8px">
                                            <strong>文章摘要：</strong>
                                        </div>
                                        <div class="col-md-6">
                                            <input type="text" class="form-control"   name="abstract" ng-model="abstract">
                                        </div>
                                    </div>

                                    <div class="col-md-12" style="padding: 10px 0px">
                                        <div class="col-md-2" style="text-align: right;margin-top: 7px">
                                            <strong>学分：</strong>
                                        </div>
                                        <div class="col-md-2">
                                            <input type="text" class="form-control"   name="period" ng-model="period">
                                        </div>
                                        <div class="col-md-2" style="text-align: right;margin-top: 7px">
                                            <strong>作者：</strong>
                                        </div>
                                        <div class="col-md-3">
                                            <input type="text" class="form-control"   name="author" ng-model="author">
                                        </div>
                                    </div>

                                    <!--<div class="col-md-12" style="padding: 10px 0px">-->
                                    <!--<div class="col-md-2" style="text-align: right;margin-top: 7px">-->
                                    <!--<strong>作者：</strong>-->
                                    <!--</div>-->
                                    <!--<div class="col-md-2">-->
                                    <!--<input type="text" class="form-control"   name="author" ng-model="author">-->
                                    <!--</div>-->
                                    <!--</div>-->

                                    <div class="col-md-12 b-r" style="margin: 10px 0px">
                                        <div class="form-group" style="position: relative">
                                            <div class="col-md-2" style="text-align: right;margin-top: 7px">
                                                <label style="display: block">封面图：</label>
                                            </div>
                                            <div class="col-md-2">
                                                <form id="form1" enctype="multipart/form-data" method="post" >
                                                    <input type="file"   id="exampleInputFile"  name="file" onchange="angular.element(this).scope().upload()">

                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row" style="margin-top: 20px;">
                                <div class="col-md-12">
                                    <script id="editor"  type="text/plain" class="ued" name="content" ></script>
                                </div>
                                <div class="col-md-12">
                                    <div class="col-md-4 col-md-offset-10">
                                        <button   class="btn btn-sm btn-primary" data-toggle="tooltip"   ng-click="subtijiao()" >提交</button>
                                        <a href="" class="btn btn-white btn-sm" data-toggle="tooltip" ng-click="fanhuishangcheng()">取消</a>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>

        </div>

    </div>

</div>
</div>



<!-- Mainly scripts -->
<script src="../js/jquery-2.1.1.js"></script>
<script src="../js/bootstrap.min.js"></script>
<script src="../js/plugins/metisMenu/jquery.metisMenu.js"></script>
<script src="../js/plugins/slimscroll/jquery.slimscroll.min.js"></script>

<!-- Custom and plugin javascript -->
<script src="../js/inspinia.js"></script>
<script src="../js/plugins/pace/pace.min.js"></script>

<!--Ueditor-->
<script type="text/javascript"  charset="utf-8" src="js/utf8-php/ueditor.config.js"></script>
<script type="text/javascript"  charset="utf-8" src="js/utf8-php/ueditor.all.min.js"></script>
<script type="text/javascript"  charset="utf-8" src="js/utf8-php/lang/zh-cn/zh-cn.js"></script>

<script src="../js/multiple/multiple-select.js"></script>
<!--<script>-->
<!--$(function() {-->
<!--$('#ms').change(function() {-->
<!--console.log($(this).val());-->
<!--var yes = $(this).val();-->
<!--}).multipleSelect({-->
<!--width: '100%'-->
<!--});-->
<!--});-->

<!--</script>-->
<!--<script src="js/mytext_add.js"></script>-->

<script>
    var app = angular.module('myApp', []);
    app.controller('myCtrl',
        function($scope, $http) {
            var fileurl = "";
            var Request = new UrlSearch(); //实例化
            $scope.user_id=localStorage.getItem("user_id");
            $scope.isShow=false;
            $scope.banner=0;
            $scope.comment=0;
            $scope.recommend=0;


//            $scope.user_id="142606654632975259";
            // 这里是把原来的 getActionUrl 方法备份 到 _bkGetActionUrl
            UE.Editor.prototype._bkGetActionUrl = UE.Editor.prototype.getActionUrl;
            UE.Editor.prototype.getActionUrl = function (action) {
                //拦截这两个，其他的不拦截,调用备份
                if (action == 'uploadimage' || action == 'uploadfile') {
                    return "https://dangjain.ishoubei.com/upload";
                } else{
                    return this._bkGetActionUrl.call(this, action);
                }
            };
            //实例化编辑器
            //建议使用工厂方法getEditor创建和引用编辑器实例，如果在某个闭包下引用该编辑器，直接调用UE.getEditor('editor')就能拿到相关的实例
            var ue = UE.getEditor('editor',{
                allHtmlEnabled: false,//提交到后台的数据是否包含整个html字符串
                autoHeightEnabled: false,
                autoFloatEnabled: true,
                allowDivTransToP: false//阻止div标签自动转换为p标签
            });

            //多选select
            $('#ms').multipleSelect({
                width: '100%'
            });
            $('#ms').change(function () {
                console.log($(this).val());
                var aaa=$(this).val();
                var bbb
                bbb=aaa.join(',')
//                $scope.type_ids=aaa;
                $scope.type_ids=bbb;
            });

            $scope.shifoushiping=function () {
                if($scope.video==true){
                    $scope.isShow=true;
                }else {
                    $scope.isShow=false;
                }
            }


            $scope.load=function () {
                var liststype=[]
                getshuju($scope.page);
                $scope.downOnClick = function () {
                    if($scope.page<$scope.pagesLists){
                        $scope.page = $scope.page+1;
                        getshuju($scope.page);
                    }
                }
                $scope.upOnClick = function () {
                    if($scope.page>1) {
                        $scope.page = $scope.page - 1;
                        getshuju($scope.page);
                    }
                }
                //获取文章类型
                function getshuju(pageID) {
                    $http.get("https://dangjain.ishoubei.com/type")
                        .then(function (res) {
                            $scope.typelistone=res.data.data;
                            for(i=0;i<$scope.typelistone.length;i++){
                                for (m=0;m<$scope.typelistone[i].childs.length;m++){
                                    liststype.push($scope.typelistone[i].childs[m])
                                }
                            }

                            getliststype(liststype)
                        });
                }

                function getliststype(aaa) {
                    $scope.type_lists=aaa
                    console.log($scope.type_lists)
                }



            }






            $scope.upload=function () {
                var form = document.getElementById('form1'),
                    formData = new FormData(form);
                $.ajax({
                    url:"https://dangjain.ishoubei.com/upload",
                    type:"post",
                    data:formData,
                    processData:false,
                    contentType:false,
                    success:function(res){
                        if(res.url){
                            fileurl = res.url
                            var  title=res.title
                        }else {
                            alert("图片错误，请重新选择图片")
                        }


                    },
                    error:function(err){
                        alert("网络连接失败,稍后重试",err);
                    }
                })
            }

            $scope.stoneClick=function () {
                if($scope.stoneIs==true){
                    $scope.recommend=1
                }else {
                    $scope.recommend=0
                }
            }

            $scope.commentClick=function () {
                if($scope.commentIs==true){
                    $scope.comment=1
                }else {
                    $scope.comment=0
                }
            }

            $scope.bannerClick=function () {
                if($scope.bannerIs==true){
                    $scope.banner=1
                }else {
                    $scope.banner=0
                }
            }





            $scope.title="";
            $scope.type_id="";
            $scope.abstract="";
            $scope.subtijiao=function () {
                var httpurl="https://dangjain.ishoubei.com"
                var imageurl=httpurl+""+fileurl
                $scope.data1 = {
                    user_id: $scope.user_id,
                    type_ids: $scope.type_ids,
                    title: $scope.title,
                    abstract: $scope.abstract,
                    content:ue.getContent(),
                    period:$scope.period,
                    credit:$scope.credit,
                    cover:imageurl,
                    urls:$scope.urls,
                    author:$scope.author,
                    recommend:$scope.recommend,
                    banner:$scope.banner,
                    comment:$scope.comment,
                    source:$scope.source,
                    dept_id:0
                };
                console.log($scope.data1)
                var url = "https://dangjain.ishoubei.com/article";
                var transFn = function (data) { return $.param(data) },
                    postCfg = { headers: { 'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8' }, transformRequest: transFn };
                $http.post(url,$scope.data1,postCfg).success(function (res) {
                    window.location.href="home.html"
//                    if($scope.type_id==21){
//                        window.location.href="home.html"
//                    }else {
//                        window.location.href="home_teach.html"
//                    }

                });
            }

            $scope.fanhuishangcheng=function () {
                window.history.back();  //返回上一页
            }

            function UrlSearch() {
                var name, value;
                var str = location.href; //取得整个地址栏
                console.log("地址="+str);
                var num = str.indexOf("?");
                str = str.substr(num + 1); //取得所有参数   stringvar.substr(start [, length ]

                var arr = str.split("&"); //各个参数放到数组里
                console.log("各个参数放到数组里="+arr);
                for (var i = 0; i < arr.length; i++) {
                    num = arr[i].indexOf("=");
                    if (num > 0) {
                        name = arr[i].substring(0, num);
                        value = arr[i].substr(num + 1);
                        this[name] = value;
                    }
                }
            }
        });

</script>



</body>

</html>
